@page
@model SAAS_Projectplanningtool.Pages.Projects.DetailsModel

@{
    ViewData["Title"] = "Details";
}

<link rel="stylesheet" href="/css/gantt.css">

<h3>@Model.Project.ProjectName</h3>
<div style="display: flex; justify-content: space-between; align-items: center;">
    <span style="color: grey; font-size: 0.9em;">
        Ersteller: @Model.Project.CreatedByEmployee.EmployeeDisplayName
        | Erstellt am: @Model.Project.CreatedTimestamp
    </span>
</div>
<hr />



<div class="row">
    <!-- Karte 1: Projektstatus -->
    <div class="col-md-2">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Projektstatus</h5>
                <p class="card-text">
                    @{
                        bool isArchived = Model.Project.IsArchived == true;
                    }
                    @if (!isArchived)
                    {
                        <form method="post" asp-page-handler="SetProjectArchived" asp-route-id="@Model.Project.ProjectId" style="display:inline;">
                            <button type="submit" class="btn btn-danger">
                                <i class="bi bi-archive"></i> Projekt archivieren
                            </button>
                        </form>
                    }
                    else
                    {
                        <form method="post" asp-page-handler="UndoProjectArchived" asp-route-id="@Model.Project.ProjectId" asp-route-origin="Details" style="display:inline;">
                            <button type="submit" class="btn btn-success">
                                <i class="bi bi-arrow-counterclockwise"></i> Projekt wiederherstellen
                            </button>
                        </form>
                    }
                </p>
            </div>
        </div>
    </div>

    <!-- Karte 2: Letzte Änderung -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Letzte Änderung</h5>
                <dl class="row mb-0">
                    <dt class="col-sm-4">Änderer</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.Project.LatestModifier.EmployeeDisplayName)</dd>

                    <dt class="col-sm-4">Zeitpunkt</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.Project.LatestModificationTimestamp)</dd>
                </dl>
                <dl class="row mb-0">
                    <dt class="col-sm-4">Änderung</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.Project.LatestModificationText)</dd>
                </dl>
            </div>
        </div>
    </div>

    <div class="col-md-7">
        <hr />
        @{
            var showCompleted = Request.Query["showCompleted"].ToString() == "true";
            //Logik ist nicht implementiert
        }

        <div class="row">
            <h3>Aufgabenkatalog</h3>

            <!-- Aufgabenliste -->
            <div class="col-md-6">
                <h4>Aufgaben</h4>

                <!-- Button zum Umschalten der Anzeige -->
                <form method="get">
                    <input type="hidden" name="showCompleted" value="@(!showCompleted)" />
                    <button type="submit" class="btn btn-sm btn-outline-primary mb-2">
                        @((showCompleted ? "Abgeschlossene Aufgaben ausblenden" : "Abgeschlossene Aufgaben einblenden"))
                    </button>
                </form>

                <!-- Aufgabenanzeige -->
                @foreach (var task in Model.TaskCatalog)
                {
                    bool isCompleted = task.State?.StateName == "Abgeschlossen";
                    if (isCompleted && !showCompleted) continue;

                    <form method="post" asp-page-handler="ToggleTaskState">

                        <input type="hidden" name="ProjectTaskId" value="@task.ProjectTaskId" />
                        <input type="hidden" name="projectId" value="@Model.Project.ProjectId" />
                        <input type="hidden" name="StateId" value="@task.StateId" />

                        <div class="form-check mb-2 p-2 rounded @(isCompleted ? "bg-light text-muted" : "")">
                            <input class="form-check-input" *@
                                  type="checkbox" 
                                  onchange="this.form.submit();" 
                           @(isCompleted ? "checked" : "") />
                            @* <button type="submit">Button</button> *@
                            <label class="form-check-label">
                                <strong>@task.ProjectTaskName</strong> – <small>@task.State?.StateName</small>
                            </label>
                        </div>
                    </form>
                }
            </div>

            <!-- Fortschrittsanzeige -->
            <div class="col-md-6">
                <h4>Abgeschlossene Aufgaben</h4>
                <h6>@Model.CompletetedTasks / @Model.TotalTasks</h6>
                <hr />
                @{
                    double circleFillTasks = Model.TotalTasks > 0
                    ? ((double)Model.CompletetedTasks / Model.TotalTasks) * 100
                    : 0;
                }
                @await Html.PartialAsync("_ProgressCircle", (int)circleFillTasks)
            </div>
        </div>
        <hr />
        <dt class="col-sm-2">
            Startdatum
        </dt>
        <dd class="col-sm-12">
            @Html.DisplayFor(model => model.Project.StartDate)
        </dd>
        <dt class="col-sm-2">
            Enddatum
        </dt>
        <dd class="col-sm-12">
            @Html.DisplayFor(model => model.Project.EndDate)
        </dd>
    </div>

    <div class="col-md-5">
        <!-- Toolbar -->
        @* <div class="btn-group mb-3" role="group">
            <button type="button" class="btn btn-primary" onclick="showAddSectionModal()">
                <i class="fas fa-plus"></i> Abschnitt hinzufügen
            </button>
            <button type="button" class="btn btn-secondary" onclick="showAddTaskModal()">
                <i class="fas fa-tasks"></i> Aufgabe hinzufügen
            </button>
        </div> *@

        <div class="mb-3">
            <button type="button" class="btn btn-secondary">
                <a asp-page="/Projects/Scheduling" asp-route-id="@Model.Project.ProjectId" class="">
                    Terminplanung
                </a>
            </button>
            <button type="button" class="btn btn-secondary">
                <a asp-page="/Projects/Ressourceplanning" asp-route-id="@Model.Project.ProjectId" class="">
                    Ressourcenplanung
                </a>
            </button>
        </div>
        <!-- Feedbackhandling -->
        @{
            var message = TempData.GetMessage();
        }
        @if (message != null)
        {
            <div class="alert alert-@message.Type.ToLower()" id="feedback-message">
                @message.Message
            </div>

            <script>
                setTimeout(function () {
                    var msg = document.getElementById('feedback-message');
                    if (msg) {
                        msg.style.transition = "opacity 0.5s ease";
                        msg.style.opacity = 0;
                        setTimeout(() => msg.remove(), 500);
                    }
                }, 3000);
            </script>
        }
        <div id="gantt-left">
            <div class="gantt-task-list">
                <div class="gantt-header">
                    <div class="task-name-header">Aufgabe</div>
                    <div class="task-duration-header">Dauer</div>
                    <div class="task-start-header">Start</div>
                    <div class="task-end-header">Ende</div>
                    <div class="task-actions-header">Aktionen</div>
                </div>
                <div id="task-list-body" class="gantt-task-list-body">
                    <!-- Tasks will be populated here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Section Modal -->
<div class="modal fade" id="addSectionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page="Scheduling" asp-route-origin="Details" asp-page-handler="CreateProjectSection">
                <div class="modal-header">
                    <h5 class="modal-title">Neuen Abschnitt hinzufügen</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="projectId" value="@Model.Project?.ProjectId" />
                    <div class="mb-3">
                        <label class="form-label">Abschnittsname</label>
                        <input type="text" class="form-control" name="Name" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Übergeordneter Abschnitt (optional)</label>
                        <select class="form-select" id="parentSectionSelect" name="parentSectionId">
                            <option value="">-- Hauptabschnitt --</option>
                            @if (Model.Project?.ProjectSections != null)
                            {
                                @foreach (var projectSection in Model.Project.ProjectSections.Where(s => s.ParentSectionId == null))
                                {
                                    <option value="@projectSection.ProjectSectionId">@projectSection.ProjectSectionName</option>
                                    @if (projectSection.SubSections != null)
                                    {
                                        @foreach (var subSection in projectSection.SubSections)
                                        {
                                            <option value="@subSection.ProjectSectionId">-- @subSection.ProjectSectionName</option>
                                        }
                                    }
                                }
                            }
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Erstellen</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Task Modal -->
<div class="modal fade" id="addTaskModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page="Scheduling" asp-route-origin="Details" asp-page-handler="CreateProjectTask">
                <div class="modal-header">
                    <h5 class="modal-title">Neue Aufgabe hinzufügen</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Aufgabenname</label>
                        <input type="text" class="form-control" name="Name" required />
                        <input type="hidden" name="projectId" value="@Model.Project.ProjectId" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Abschnitt</label>
                        <select class="form-select" id="taskSectionSelect" name="SectionId" required>
                            <option value="">-- Abschnitt auswählen --</option>
                            @if (Model.Project?.ProjectSections != null)
                            {
                                @foreach (var projectSection in Model.Project.ProjectSections.Where(s => s.ParentSectionId == null))
                                {
                                    <option value="@projectSection.ProjectSectionId">@projectSection.ProjectSectionName</option>
                                    @if (projectSection.SubSections != null)
                                    {
                                        @foreach (var subSection in projectSection.SubSections)
                                        {
                                            <option value="@subSection.ProjectSectionId">-- @subSection.ProjectSectionName</option>
                                        }
                                    }
                                }
                            }
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">Startdatum</label>
                            <input type="date" class="form-control" name="startDate" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Enddatum</label>
                            <input type="date" class="form-control" name="endDate" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Erstellen</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Item Modal -->
<div class="modal fade" id="addItemModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Was möchten Sie anlegen?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body d-grid gap-3">
                <button id="chooseTaskBtn" class="btn btn-outline-success btn-lg">
                    <i class="fas fa-tasks me-2"></i> Aufgabe
                </button>
                <button id="chooseSubBtn" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-sitemap me-2"></i> Unterabschnitt
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add Sub-Section Modal -->
<div class="modal fade" id="addSubSectionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page="Scheduling" asp-route-origin="Details" asp-page-handler="CreateSubSection">
                <div class="modal-header">
                    <h5 class="modal-title">Neuen Unterabschnitt hinzufügen</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    <input type="hidden" name="projectId" value="@Model.Project.ProjectId" />
                </div>
                <div class="modal-body">
                    <input type="hidden" id="parentSubSectionId" name="parentSectionId" />
                    <div class="mb-3">
                        <label class="form-label">Unterabschnittsname</label>
                        <input type="text" class="form-control" name="Name" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Erstellen</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Task Modal -->
<div class="modal fade" id="editTaskModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page="Scheduling" asp-route-origin="Details" asp-page-handler="EditProjectTask">
                <div class="modal-header">
                    <h5 class="modal-title">Aufgabe bearbeiten</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editTaskId" name="taskId" />
                    <input type="hidden" name="projectId" value="@Model.Project.ProjectId" />
                    <div class="mb-3">
                        <label class="form-label">Aufgabenname</label>
                        <input type="text" class="form-control" id="editTaskName" name="name" />
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">Startdatum</label>
                            <input type="date" class="form-control" id="editTaskStartDate" name="startDate" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Enddatum</label>
                            <input type="date" class="form-control" id="editTaskEndDate" name="endDate" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page="Scheduling" asp-route-origin="Details" asp-page-handler="DeleteSelected">
                <div class="modal-header">
                    <h5 class="modal-title">Löschen bestätigen</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteConfirmText">Sind Sie sicher, dass Sie dieses Element löschen möchten?</p>
                    <input type="hidden" id="deleteObjectJson" name="objectJson" />
                    <input type="hidden" name="Project.ProjectId" value="@Model.Project?.ProjectId" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                    <button type="submit" class="btn btn-danger">Löschen</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    /* ───────────────────────── Daten aus Razor ───────────────────────── */
    const projectData = {
        project: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(new
        {
            Id = Model.Project.ProjectId,
            Name = Model.Project.ProjectName,
            Sections = Model.Project.ProjectSections?
           .Where(s => s.ParentSectionId == null).Select(s => new
           {
           Id = s.ProjectSectionId,
           Name = s.ProjectSectionName,
           Type = "section",
           State = s.State != null ? new { StateName = s.State.StateName, Color = s.State.Color } : null,
           SubSections = s.SubSections?.Select(sub => new
           {
               Id = sub.ProjectSectionId,
               Name = sub.ProjectSectionName,
               Type = "subsection",
               State = sub.State != null ? new { StateName = sub.State.StateName, Color = sub.State.Color } : null,
               Tasks = sub.ProjectTasks?.Select(t => new
               {
                   Id = t.ProjectTaskId,
                   Name = t.ProjectTaskName,
                   StartDate = t.StartDate?.ToString("yyyy-MM-dd"),
                   EndDate = t.EndDate?.ToString("yyyy-MM-dd"),
                   Type = "task",
                   State = t.State != null ? new { StateName = t.State.StateName, Color = t.State.Color } : null
               })
           }),
           Tasks = s.ProjectTasks?.Select(t => new
           {
               Id = t.ProjectTaskId,
               Name = t.ProjectTaskName,
               StartDate = t.StartDate?.ToString("yyyy-MM-dd"),
               EndDate = t.EndDate?.ToString("yyyy-MM-dd"),
               Type = "task",
               State = t.State != null ? new { StateName = t.State.StateName, Color = t.State.Color } : null
           })
           })
        }))
    };

    /* ───────────────────── Collapse-State & Utils ────────────────────── */
    const collapsed = new Map();

    function isCollapsed(id) {
        return collapsed.has(id) && collapsed.get(id);
    }

    function toggleCollapse(id) {
        collapsed.set(id, !isCollapsed(id));
        renderTaskList();
    }

    /* Datumshilfen */
    function calculateDuration(s, e) {
        if (!s || !e) return '-';
        const d = Math.ceil((new Date(e) - new Date(s)) / 86400000) + 1;
        return d + 'd';
    }

    function formatDate(d) {
        if (!d) return '-';
        return new Date(d).toLocaleDateString('de-DE');
    }

    /* Frühester/Spätester Termin unterhalb eines Knotens */
    function getRange(node) {
        let min = node.StartDate ? new Date(node.StartDate) : null;
        let max = node.EndDate ? new Date(node.EndDate) : null;

        if (node.SubSections) {
            node.SubSections.forEach(s => {
                const [a, b] = getRange(s);
                if (a && (!min || a < min)) min = a;
                if (b && (!max || b > max)) max = b;
            });
        }
        if (node.Tasks) {
            node.Tasks.forEach(t => {
                if (t.StartDate) {
                    const d = new Date(t.StartDate);
                    if (!min || d < min) min = d;
                }
                if (t.EndDate) {
                    const d = new Date(t.EndDate);
                    if (!max || d > max) max = d;
                }
            });
        }
        return [min, max];
    }

    /* Standard: eingeklappt */
    function preloadCollapse() {
        function walk(node) {
            if (node.Type !== 'task') {
                collapsed.set(node.Id, true);
                if (node.SubSections) node.SubSections.forEach(walk);
            }
        }
        projectData.project.Sections?.forEach(walk);
    }

    /* ───────────────────── Rendering der linken Liste ─────────────────── */
    function renderTaskList() {
        const body = document.getElementById('task-list-body');
        body.innerHTML = '';

        if (!projectData.project.Sections || projectData.project.Sections.length === 0) {
            body.innerHTML = '<div class="empty-state">📋 Keine Abschnitte oder Aufgaben vorhanden</div>';
            return;
        }

        projectData.project.Sections.forEach(sec => walk(sec, 0));

        /* Footer-Adder ganz unten */
        const footer = document.createElement('div');
        footer.className = 'task-row adder-row';
        footer.dataset.level = 0;
        footer.innerHTML = `
            <div class="task-name">
                <button class="btn btn-sm btn-outline-primary"
                        onclick="showAddSectionModal()">
                   <i class="fas fa-plus"></i> Neuer Abschnitt
                </button>
            </div>`;
        body.appendChild(footer);

        function walk(node, depth) {
            addRow(node, depth);

            if (node.Type === 'task' || isCollapsed(node.Id)) return;

            /* Inline-Adder hinter jedem Nicht-Task */
            if (node.Type !== 'task') {
                const adder = document.createElement('div');
                adder.className = 'task-row adder-row';
                adder.style.setProperty('--lvl', depth);
                adder.innerHTML = `
                   <div class="task-name">
                      <button class="btn btn-sm btn-outline-primary"
                              onclick="showAddItemModal('${node.Id}','${node.Type}')">
                          <i class="fas fa-plus"></i>
                      </button>
                   </div>`;
                body.appendChild(adder);
            }

            if (node.SubSections) {
                node.SubSections.forEach(s => walk(s, depth + 1));
            }
            if (node.Tasks) {
                node.Tasks.forEach(t => walk(t, depth + 1));
            }
        }

        function addRow(item, depth) {
            const row = document.createElement('div');
            row.className = `task-row ${item.Type}`;
            row.style.setProperty('--lvl', depth);

            /* Pfeil für aufklappbare Elemente */
            const hasChildren =
                 (item.SubSections && item.SubSections.length) ||
                 (item.Tasks && item.Tasks.length);

            const fold = isCollapsed(item.Id);
            const caret = hasChildren
                ? `<i class="fas fa-caret-down caret ${fold ? 'collapsed' : ''}"
                      data-id="${item.Id}"></i>`
                : '';

            /* Daten für Section/Subsection berechnen */
            let start = item.StartDate;
            let end = item.EndDate;

            if (item.Type !== 'task') {
                const [min, max] = getRange(item);
                start = min ? min.toISOString().slice(0, 10) : null;
                end = max ? max.toISOString().slice(0, 10) : null;
            }

            /* Status Badge */
            const statusBadge = item.State
                ? `<span class="statecolorcontainer badge" style="background-color: ${item.State.Color}">${item.State.StateName}</span>`
                : '<span class="text-muted">Kein Status</span>';

            const isTask = item.Type === 'task';

            row.innerHTML = `
               <div class="task-name">${caret}${item.Name}</div>
               <div class="task-duration">${calculateDuration(start, end)}</div>
               <div class="task-start">${formatDate(start)}</div>
               <div class="task-end">${formatDate(end)}</div>
               <div class="task-actions">
                    ${isTask ? `
                        <button class="btn btn-sm btn-outline-primary me-1"
                                onclick="editTask('${item.Id}', '${item.Name}',
                                                  '${item.StartDate || ''}', '${item.EndDate || ''}')">
                            <i class="fas fa-edit"></i>
                        </button>` : ''}
                    <button class="btn btn-sm btn-outline-danger"
                            onclick="deleteItem('${item.Id}', '${item.Type}', '${item.Name}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>`;

            body.appendChild(row);
        }
    }

    /* ───────── Modal Functions ───────── */
    function showAddSectionModal() {
        new bootstrap.Modal(document.getElementById('addSectionModal')).show();
    }

    function showAddTaskModal(sectionId = null) {
        if (sectionId) {
            const sel = document.getElementById('taskSectionSelect');
            if (sel) sel.value = sectionId;
        }
        new bootstrap.Modal(document.getElementById('addTaskModal')).show();
    }

    function showAddSubSectionModal(parentId) {
        document.getElementById('parentSubSectionId').value = parentId;
        new bootstrap.Modal(document.getElementById('addSubSectionModal')).show();
    }

    let addItemParentId = null;
    let addItemParentType = null;

    function showAddItemModal(parentId, parentType) {
        addItemParentId = parentId;
        addItemParentType = parentType;

        const subBtn = document.getElementById('chooseSubBtn');
        subBtn.disabled = (parentType !== 'section');

        new bootstrap.Modal(document.getElementById('addItemModal')).show();
    }

    function editTask(taskId, taskName, startDate, endDate) {
        document.getElementById('editTaskId').value = taskId;
        document.getElementById('editTaskName').value = taskName;
        document.getElementById('editTaskStartDate').value = startDate;
        document.getElementById('editTaskEndDate').value = endDate;

        new bootstrap.Modal(document.getElementById('editTaskModal')).show();
    }

    function deleteItem(itemId, itemType, itemName) {
        document.getElementById('deleteConfirmText').textContent =
            `Sind Sie sicher, dass Sie "${itemName}" löschen möchten?`;

        const jsonData = {
            Type: itemType === 'task' ? 'ProjectTask' : 'ProjectSection',
            Data: { itemId, itemName }
        };

        document.getElementById('deleteObjectJson').value = JSON.stringify(jsonData);

        new bootstrap.Modal(document.getElementById('deleteModal')).show();
    }

    /* ───────── Event Listeners ───────── */
    document.addEventListener('click', ev => {
       if (ev.target.classList.contains('caret')) {
           toggleCollapse(ev.target.dataset.id);
           ev.stopPropagation();
       }
    });

    document.addEventListener('DOMContentLoaded', () => {
        preloadCollapse();
        renderTaskList();

        document.getElementById('chooseTaskBtn').addEventListener('click', () => {
            bootstrap.Modal.getInstance(document.getElementById('addItemModal')).hide();
            showAddTaskModal(addItemParentId);
        });

        document.getElementById('chooseSubBtn').addEventListener('click', () => {
            bootstrap.Modal.getInstance(document.getElementById('addItemModal')).hide();
            showAddSubSectionModal(addItemParentId);
        });
    });
</script>

<!-- Include Bootstrap and FontAwesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>